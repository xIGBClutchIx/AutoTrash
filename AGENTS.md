# Agent Guide for AutoTrash

This file defines build, test, and style expectations for agents.
It applies to the whole repository.

## Repo Overview
- Java plugin project for Hytale Server.
- Entry point class: `me.clutchy.hytale.autotrash.AutoTrashPlugin`.
- Source root: `src/main/java`.
- UI resources under `src/main/resources`.
- Tests (if added) go in `src/test/java`.
- Compiled outputs appear under `bin/` and `.gradle/` (do not edit).

## Agent Behavior and Boundaries
- Agents may read:
  - Java source under `src/main/java`.
  - UI assets under `src/main/resources`.
  - Extracted runtime files under `run/runtime/<version>/` for reference only, including decompiled server classes and `Assets.zip` contents.
- Agents may modify:
  - Project files under the repository root, excluding runtime/cache/output folders.
- Agents must never:
  - Modify files under `run/`.
  - Modify extracted server classes or assets.
  - Copy runtime artifacts into the repository.
  - Commit runtime or cache files.
  - Reference user-installed Hytale paths.
  - Add or reference local SDK jars such as `libraries/HytaleServer.jar`.

## Hytale Runtime and Manifest
- `HytaleServer.jar` and `Assets.zip` are provisioned by the RunHytale Gradle plugin.
- Runtime files live under `run/runtime/<version>/`.
- Use `./gradlew runHytale` to provision the runtime before compilation or inspection.
- `manifest.json` is generated by the Manifest Factory plugin.
- Generated manifest path: `build/generated/manifestfactory/manifest.json`.
- Do not manually edit or commit `manifest.json`.

## Plugin Architecture
- **AutoTrashPlugin.java** - Plugin entry point, registers components, events, and commands.
- **AutoTrashPlayerSettings.java** - Per-player component storing settings (enabled, notify, exactItems[]).
- **AutoTrashSystem.java** - Handles inventory change events and removes configured trash items.
- **TrashCommand.java** - `/trash` command that opens the configuration GUI and routes subcommands.
- **TrashAddCommand.java** - `/trash add <itemId>` adds an item to the auto-trash list.
- **TrashRemoveCommand.java** - `/trash remove <itemId>` removes an item from the auto-trash list.
- **TrashEnableCommand.java** - `/trash enable [true/false]` toggles auto-trash enabled state.
- **TrashNotifyCommand.java** - `/trash notify [true/false]` toggles auto-trash notifications.
- **TrashOnCommand.java** - `/trash on` enables auto-trash.
- **TrashOffCommand.java** - `/trash off` disables auto-trash.

## UI Resources
- UI page: `src/main/resources/Common/UI/Custom/Pages/AutoTrashConfigPage.ui`.
- Uses shared components from `../Common.ui`.

## Build / Run / Test
Use `./gradlew` (wrapper checked in).

Build:
```bash
./gradlew build
```

Clean:
```bash
./gradlew clean
```

Compile only:
```bash
./gradlew classes
```

Test:
```bash
./gradlew test
```

Single test class:
```bash
./gradlew test --tests "com.example.MyTest"
```

Single test method:
```bash
./gradlew test --tests "com.example.MyTest.myMethod"
```

Run (if application plugin is added later):
```bash
./gradlew run
```

Lint/format:
- Use `./gradlew spotlessApply` to format.
- Use `./gradlew spotlessCheck` to verify formatting.

## Code Style (Java)
Use the existing style in `src/main/java`.

### Formatting
- 4 spaces per indent, no tabs.
- Opening brace on same line as declaration.
- One statement per line.
- Wrap long calls with hanging indent (8 spaces).
- Keep blank lines between methods and fields.
- Limit line length to ~120 where possible.

### Imports
- No wildcard imports.
- Order groups: `java.*`, `javax.*`, third-party (`com.hypixel.*`), then project.
- Separate import groups with a single blank line.

### Naming
- Packages: lowercase with dots (`me.clutchy.hytale.autotrash`).
- Classes: PascalCase (`AutoTrashPlugin`).
- Methods/fields: lowerCamelCase.
- Constants: UPPER_SNAKE_CASE.
- Avoid one-letter names except for indices.

### Types and Nullability
- Prefer explicit types; avoid raw types.
- Use `@Nonnull` for required params and override signatures.
- Do not return `null` when an empty object is available.
- Keep fields `final` when not reassigned.

### Logging
- Use `HytaleLogger.forEnclosingClass()` for class loggers.
- Log important lifecycle events in `setup()`.
- Avoid noisy debug logs unless explicitly requested.

### Plugin Lifecycle
- Extend `JavaPlugin`.
- Use constructor for minimal initialization only.
- Register commands/listeners in `setup()`.
- Keep `setup()` quick; avoid heavy blocking work.

### Commands
- Extend `CommandBase`.
- Provide short command name and description.
- Set permission group explicitly.
- Use `Message.raw(...)` for simple chat messages.
- Keep command execution in `executeSync`.

### Error Handling
- Fail fast with clear exceptions for bad state.
- Do not swallow exceptions; log and rethrow when needed.
- Prefer checked exceptions only when callers can recover.
- Validate external inputs early (commands, configs).

### Comments and Docs
- Use Javadoc for public classes/methods only.
- Keep comments concise and factual.
- Do not add TODOs unless asked.

## Commit Messages
Conventional commits: use `type(scope): subject` format for the first line.
- Types: `feat`, `fix`, `docs`, `chore`, `refactor`, `test`, `build`.
- Scope is optional but preferred when change is localized.
- Keep the subject in imperative mood, lowercase, and under 72 chars.
- Use body bullets for rationale or breaking changes when needed.

## File Hygiene
- Do not edit compiled output in `bin/`.
- Do not commit `.gradle/` content.
- Keep resources under `src/main/resources`.

## Quick Reference
- Main class: `me.clutchy.hytale.autotrash.AutoTrashPlugin`.
- Build task: `./gradlew build`.
- Test task: `./gradlew test`.
- Single test: `./gradlew test --tests "com.example.MyTest"`.

End of agent guidance.
